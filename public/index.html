<!DOCTYPE html>
<html lang="en">
<!-- 
TODO:
- City Input
- API Return
    - Packing: 
        - umbrealla if there is rain anytime over the next 4-days
        - Cold - Temp < 12C
        - Mild - 12C <= Temp <= 24C
        - Hot - Temp > 24C
    - Summary of next 4 days showing: 
        - Temperature
        - Wind Speed
        - Rainfall level.
    - Air Pollution - PM2_5 forecast for the next 5 days
        - advise the user to wear a mask if PM2_5 > 10
    - One Innovative Feature 

 -->

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vuether</title>
    <!-- Include Vue -->
    <script type="importmap">
        {
            "imports": {
                "vue": "https://unpkg.com/vue@3/dist/vue.esm-browser.js"
            }
        }
    </script>
    <script type="module">
        import { createApp } from 'vue'
        createApp({
            data() {
                return {
                    city: '',
                    hasError: false,
                    errorMsg: '',
                    weatherJSON: null,
                    willRain: null,
                    maskAdvised: null,
                    tempSentiment: null,
                    airPolJSON:null
                }
            },
            methods: {
                getWeatherForecast() {
                    console.log(`Requesting weather forecast for ${this.city} from OpenWeather...`);

                    fetch(`http://localhost:3000/forecast/${this.city}`)
                        .then((response) => {
                            // if the response is ok
                            if (response.status === 200) return response.json();
                            else throw Error(response.statusText);
                        }).then(responseJSON => {
                            console.log(responseJSON);
                            this.weatherJSON = responseJSON.forecastData;
                            this.willRain = responseJSON.willRain;
                            this.tempSentiment = responseJSON.tempSentiment;
                            this.maskAdvised = responseJSON.maskAdvised;
                            this.airPolJSON=responseJSON.airPollutionData;
                            // Reset any errors
                            this.hasError = false;
                            this.errorMsg = '';
                        })
                        .catch(error => {
                            console.error(error);

                            // Set error messages
                            this.hasError = true;
                            this.errorMsg = `Can't fetch weather data for ${this.city} :(`;
                        });
                }
            }
        }).mount('#app')
    </script>
</head>

<body>
    <div id="app">
        <h1>Vuether</h1>
        <br />
        <h2>Enter city name for today's weather and its forecast for the next four days:</h2>
        <div>
            <div>
                <input v-model="city" type="text" v-model="city"
                    placeholder="City..." required />
            </div>
            <button v-on:click="getWeatherForecast">Search🔍</button>
        </div>

        <span v-if="hasError">
            Error: {{errorMsg}}
        </span>

        <!-- Umbrella Packing Tips -->
        <div v-if="!hasError && willRain != null">
            
            <h2>🌂 Should I bring an umbrella?</h2>
            <span v-if="willRain">☔ Bring an umbrella with ya, you don't wanna get soaked.</span>
            <span v-if="!willRain">🌞 Keep your umbrella at home, and enjoy some sunny days, or maybe cloudy.</span>
            
        </div>

        <!-- Clothes Packing Tips by Temperature Sentiment-->
        <div v-if="!hasError && tempSentiment != null">
            
            <h2>👔 What kind of clothes should I pack?</h2>
            <span v-if="tempSentiment.weatherType == 'hot'">🥵Hot weather({{tempSentiment.min}}°C - {{tempSentiment.max}}°C).
                <br/>👕 Pack some light cloths and stay hydrated!
            </span>
            <span v-if="tempSentiment.weatherType == 'mild'">🤗Mild weather({{tempSentiment.min}}°C - {{tempSentiment.max}}°C).
                <br/>👘 Pack a few extra layers just in case.</span>
            <span v-if="tempSentiment.weatherType == 'cold'">🥶Cold weather({{tempSentiment.min}}°C - {{tempSentiment.max}}°C).
                <br/>🏂 Pack some warm clothes and maybe enjoy a hot cuppa.</span>
            
        </div>

        <!-- Masking tips -->
        <div v-if="!hasError && maskAdvised != null">
            
            <h2>🏭 Should I wear a mask?</h2>
            <span v-if="maskAdvised">😷 The air quality is going to be rough. You should wear a mask!</span>
            <span v-if="!maskAdvised">😃 The air quality is going be good. Enjoy the fresh air!</span>
            
        </div>

        <table v-if="!hasError && weatherJSON">
            <thead>
                <tr>
                    <th>📆</th>
                    <th>Real Lowest 🌡️(°C)</th>
                    <th>Lowest 🌡️(°C)</th>
                    <th>Avg.🌡️ (°C)</th>
                    <th>Highest 🌡️(°C)</th>
                    <th>Real LowestHighest 🌡️(°C)</th>
                    <th>☴(m/s)</th>
                    <th>☔(mm)</th>
                </tr>
            </thead>
            <tbody>
                <template v-for="(forecastData, date) in weatherJSON">
                    <tr>
                        <td>|<u>{{ date }}</u></td>
                        <td>|<u>{{ forecastData.minTemp }}</u></td>
                        <td>|<u>{{ forecastData.tempRange.min }}</u></td>
                        <td>|<u>{{ forecastData.avgTemp }}</u></td>
                        <td>|<u>{{ forecastData.tempRange.max }}</u></td>
                        <td>|<u>{{ forecastData.maxTemp }}</u></td>
                        <td>|<u>{{ forecastData.avgWind }}</u></td>
                        <td>|<u>{{ forecastData.rainfallLevels }}</u></td>
                    </tr>
                </template>
            </tbody>
        </table>
        <table v-if="!hasError&&airPolJSON">
            <thead>
                <tr>
                    <th>📆</th>
                    <th>avgPM2_5</th>
                    <!-- <th>pm2_5</th> -->
                </tr>
            </thead>
            <tbody>
                <template v-for="(airPolData, date) in airPolJSON">
                    <tr>
                        <td>|<u>{{ date }}</u></td>
                        <td>|<u>{{ airPolData.avgPM2_5 }}</u></td>
                        <!-- <td>|<u>{{ airPolData.pm2_5 }}</u></td> -->
                    </tr>
                </template>
            </tbody>
        </table>
    </div>
</body>

</html>